<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ระบบทำข้อสอบใบประกอบครู เป้ (HTML + JavaScript)</title>
  <style>
    :root {
      --bg: #0f172a; --card: #111827; --muted: #94a3b8; --text: #e5e7eb;
      --primary: #22d3ee; --accent: #a78bfa; --danger: #f87171; --success: #34d399; --warning: #fbbf24;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Segoe UI,Roboto,Arial;background:#0f172a;color:var(--text);min-height:100vh}
    .container{max-width:1000px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .title{font-size:1.4rem;font-weight:700}
    .badge{padding:6px 10px;border:1px solid #334155;border-radius:999px;color:var(--muted);font-size:.85rem}
    .tabs{margin-top:16px;display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{border:1px solid #27304a;background:#111827;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .tab-btn[aria-selected="true"]{outline:2px solid var(--primary);color:#0e7490;background:#081427}
    .card{background:#111827;border:1px solid #1f2a44;padding:18px;border-radius:16px;margin-top:12px}
    .grid{display:grid;gap:16px}.grid-2{grid-template-columns:repeat(2,1fr)}
    @media(max-width:820px){.grid-2{grid-template-columns:1fr}}
    .input,select,textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #26324f;background:#0c1224;color:var(--text)}
    label{font-size:.9rem;color:var(--muted);margin-bottom:6px;display:inline-block}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid #204657;background:#071925;color:#a7f3d0;font-weight:700;cursor:pointer}
    .btn.primary{border-color:#0e7490;background:#042c3a;color:var(--primary)}
    .btn.accent{border-color:#5b21b6;background:#1f1145;color:var(--accent)}
    .btn.danger{border-color:#7f1d1d;background:#2a0f12;color:var(--danger)}
    .btn.ghost{border-color:#1f2a44;background:transparent;color:var(--muted)}
    .divider{height:1px;background:#1f2a44;margin:12px 0}
    .muted{color:var(--muted)}.pill{display:inline-flex;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #26324f;color:var(--muted)}
    .question{padding:16px;border:1px solid #1f2a44;border-radius:12px;background:#0b1225}
    .choice{padding:10px;border:1px solid #1f2a44;border-radius:10px;margin-top:8px;cursor:pointer}
    .choice.correct{border-color:#165c3a;background:#0d1f16}
    .choice.incorrect{border-color:#5c1622;background:#1f0d12}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <div class="title">ระบบทำข้อสอบใบประกอบวิชาชีพครู เป้</div>
      <div class="muted">ทำข้อสอบ • เพิ่ม/แก้ไข • LocalStorage • Import/Export</div>
    </div>
    <span class="badge">HTML + JS</span>
  </header>

  <nav class="tabs">
    <button class="tab-btn" aria-selected="true" data-tab="exam">ทำข้อสอบ</button>
    <button class="tab-btn" aria-selected="false" data-tab="manage">จัดการข้อสอบ</button>
    <button class="tab-btn" aria-selected="false" data-tab="import">นำเข้า/ส่งออก</button>
    <button class="tab-btn" aria-selected="false" data-tab="help">วิธีใช้งาน</button>
  </nav>

  <!-- Exam -->
  <section id="tab-exam" class="card">
    <div class="grid grid-2">
      <div><label>หมวดหมู่</label><select id="filter-category"></select></div>
      <div><label>จำนวนข้อ</label><input id="exam-count" class="input" type="number" value="5" min="1"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button id="start-exam" class="btn primary">เริ่มทำข้อสอบ</button>
      <button id="submit-exam" class="btn accent" disabled>ส่งคำตอบ</button>
      <button id="reset-exam" class="btn ghost" disabled>ล้าง</button>
      <span id="progress" class="pill">ยังไม่เริ่ม</span>
    </div>
    <div id="exam-area" class="grid"></div>
    <div id="exam-result"></div>
  </section>

  <!-- Manage -->
  <section id="tab-manage" class="card" hidden>
    <h3>เพิ่ม/แก้ไขข้อสอบ</h3>
    <form id="question-form" class="grid">
      <div class="grid grid-2">
        <div><label>หมวดหมู่</label><input id="q-category" class="input"></div>
        <div><label>เฉลย/เหตุผล</label><input id="q-explain" class="input"></div>
      </div>
      <label>คำถาม</label><textarea id="q-text" class="input"></textarea>
      <div class="grid grid-2">
        <div><label>ก.</label><input id="c0" class="input"></div>
        <div><label>ข.</label><input id="c1" class="input"></div>
        <div><label>ค.</label><input id="c2" class="input"></div>
        <div><label>ง.</label><input id="c3" class="input"></div>
      </div>
      <div class="grid grid-2">
        <div><label>คำตอบที่ถูก (0-3)</label><input id="q-answer" type="number" min="0" max="3" value="0" class="input"></div>
        <div><button class="btn primary" type="submit">บันทึก</button></div>
      </div>
      <input type="hidden" id="editing-id">
    </form>
    <div class="divider"></div>
    <div><button id="seed-btn" class="btn">โหลดตัวอย่าง</button>
    <button id="wipe-btn" class="btn danger">ลบคลัง</button></div>
    <div id="question-list" class="grid"></div>
  </section>

  <!-- Import -->
  <section id="tab-import" class="card" hidden>
    <button id="export-json" class="btn">ดาวน์โหลด (.json)</button>
    <textarea id="import-text" rows="6" class="input" placeholder="วาง JSON ข้อสอบที่นี่"></textarea>
    <button id="import-apply" class="btn primary">นำเข้า</button>
  </section>

  <!-- Help -->
  <section id="tab-help" class="card" hidden>
    <ol>
      <li>ไปที่แท็บ "จัดการข้อสอบ" เพื่อเพิ่ม/แก้ไข</li>
      <li>กลับไป "ทำข้อสอบ" เพื่อเริ่ม</li>
      <li>กดส่งคำตอบเพื่อดูผลลัพธ์</li>
      <li>สามารถ Import/Export JSON ได้</li>
    </ol>
  </section>
</div>

<script>
const TABS=document.querySelectorAll(".tab-btn");
TABS.forEach(btn=>btn.onclick=()=>{
  TABS.forEach(b=>b.setAttribute("aria-selected","false"));
  btn.setAttribute("aria-selected","true");
  document.querySelectorAll("section").forEach(s=>s.hidden=true);
  document.getElementById("tab-"+btn.dataset.tab).hidden=false;
});

// LocalStorage
let QUESTIONS=JSON.parse(localStorage.getItem("questions")||"[]");
function saveQ(){localStorage.setItem("questions",JSON.stringify(QUESTIONS));renderList();renderCategory();}

// Render category options
function renderCategory(){
  const sel=document.getElementById("filter-category");
  sel.innerHTML="<option value='all'>ทั้งหมด</option>";
  [...new Set(QUESTIONS.map(q=>q.category))].forEach(c=>sel.innerHTML+=`<option>${c}</option>`);
}

// Render manage list
function renderList(){
  const div=document.getElementById("question-list");
  div.innerHTML="";
  QUESTIONS.forEach((q,i)=>{
    let d=document.createElement("div");
    d.className="question";
    d.innerHTML=`<b>${i+1}. ${q.text}</b><br>หมวด: ${q.category}<br>คำตอบ: ${["ก","ข","ค","ง"][q.answerIndex]}<br><button onclick="editQ(${i})" class="btn">แก้ไข</button> <button onclick="delQ(${i})" class="btn danger">ลบ</button>`;
    div.appendChild(d);
  });
}
function editQ(i){
  let q=QUESTIONS[i];
  document.getElementById("q-category").value=q.category;
  document.getElementById("q-explain").value=q.explanation;
  document.getElementById("q-text").value=q.text;
  ["c0","c1","c2","c3"].forEach((id,j)=>document.getElementById(id).value=q.choices[j]);
  document.getElementById("q-answer").value=q.answerIndex;
  document.getElementById("editing-id").value=i;
}
function delQ(i){QUESTIONS.splice(i,1);saveQ();}

// Form submit
document.getElementById("question-form").onsubmit=e=>{
  e.preventDefault();
  const q={
    category:document.getElementById("q-category").value,
    text:document.getElementById("q-text").value,
    choices:[
      document.getElementById("c0").value,
      document.getElementById("c1").value,
      document.getElementById("c2").value,
      document.getElementById("c3").value
    ],
    answerIndex:+document.getElementById("q-answer").value,
    explanation:document.getElementById("q-explain").value
  };
  let idx=document.getElementById("editing-id").value;
  if(idx==="")QUESTIONS.push(q);else QUESTIONS[idx]=q;
  document.getElementById("question-form").reset();
  document.getElementById("editing-id").value="";
  saveQ();
};

// Seed example
document.getElementById("seed-btn").onclick=()=>{
  QUESTIONS=[{category:"จรรยาบรรณ",text:"ข้อใดคือจรรยาบรรณวิชาชีพครู",choices:["รักษาความลับ","ไม่เอาเปรียบ","ซื่อสัตย์","ทั้งหมด"],answerIndex:3,explanation:"ครูต้องรักษาจรรยาบรรณทุกด้าน"}];
  saveQ();
};
document.getElementById("wipe-btn").onclick=()=>{
  if(confirm("ลบทั้งหมด?")){QUESTIONS=[];saveQ();}
};

// Exam
document.getElementById("start-exam").onclick=()=>{
  let count=+document.getElementById("exam-count").value;
  let cat=document.getElementById("filter-category").value;
  let pool=cat==="all"?QUESTIONS:QUESTIONS.filter(q=>q.category===cat);
  pool=pool.sort(()=>Math.random()-0.5).slice(0,count);
  const examArea=document.getElementById("exam-area");
  examArea.innerHTML="";
  pool.forEach((q,i)=>{
    let div=document.createElement("div");
    div.className="question";
    div.innerHTML=`<b>${i+1}. ${q.text}</b>`;
    q.choices.forEach((c,j)=>{
      let ch=document.createElement("div");
      ch.className="choice";ch.textContent=["ก","ข","ค","ง"][j]+". "+c;
      ch.onclick=()=>{
        div.querySelectorAll(".choice").forEach(x=>x.style.outline="");
        ch.style.outline="2px solid cyan";ch.dataset.selected=j;
      };
      div.appendChild(ch);
    });
    div.dataset.answer=q.answerIndex;div.dataset.explain=q.explanation;
    examArea.appendChild(div);
  });
  document.getElementById("progress").textContent="กำลังทำข้อสอบ";
  document.getElementById("submit-exam").disabled=false;
  document.getElementById("reset-exam").disabled=false;
};

document.getElementById("submit-exam").onclick=()=>{
  let correct=0,total=document.getElementById("exam-area").children.length;
  [...document.getElementById("exam-area").children].forEach(div=>{
    let sel=[...div.querySelectorAll(".choice")].find(c=>c.style.outline);
    let ans=+div.dataset.answer;
    if(sel){
      let idx=+sel.dataset.selected;
      if(idx===ans){sel.classList.add("correct");correct++;}
      else sel.classList.add("incorrect");
    }
    let exp=document.createElement("div");
    exp.className="muted";
    exp.textContent="เฉลย: "+["ก","ข","ค","ง"][ans]+" ("+div.dataset.explain+")";
    div.appendChild(exp);
  });
  document.getElementById("progress").textContent=`ได้ ${correct}/${total} คะแนน`;
};

document.getElementById("reset-exam").onclick=()=>{
  document.getElementById("exam-area").innerHTML="";
  document.getElementById("exam-result").innerHTML="";
  document.getElementById("progress").textContent="ยังไม่เริ่ม";
  document.getElementById("submit-exam").disabled=true;
  document.getElementById("reset-exam").disabled=true;
};

// Import Export
document.getElementById("export-json").onclick=()=>{
  let blob=new Blob([JSON.stringify(QUESTIONS)],{type:"application/json"});
  let a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="questions.json";a.click();
};
document.getElementById("import-apply").onclick=()=>{
  try{
    let arr=JSON.parse(document.getElementById("import-text").value);
    if(Array.isArray(arr)){QUESTIONS=arr;saveQ();alert("นำเข้าสำเร็จ");}
  }catch(e){alert("JSON ไม่ถูกต้อง");}
};

// Init
renderList();renderCategory();
</script>
</body>
</html>
